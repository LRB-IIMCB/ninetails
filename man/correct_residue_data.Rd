% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/ninetails_data_postprocessing_functions.R
\name{correct_residue_data}
\alias{correct_residue_data}
\title{Marks uncertain positions of non-A residues in ninetails output data.}
\usage{
correct_residue_data(
  class_data,
  residue_data,
  grouping_factor = NULL,
  transcript_column,
  ref = NULL
)
}
\arguments{
\item{class_data}{Data frame or tibble containing read_classes
predictions from the ninetails pipeline.}

\item{residue_data}{Data frame or tibble containing non-A residue
predictions from the ninetails pipeline.}

\item{grouping_factor}{Character string or \code{NULL} (default). A
grouping variable (e.g. \code{"sample_name"}, \code{"group"}).}

\item{transcript_column}{Character string. Name of the column
containing transcript identifiers (e.g.
\code{"ensembl_transcript_id_short"}).}

\item{ref}{Character string, character vector, or \code{NULL}
  (default). Whitelist of transcripts with hybrid tails. Built-in
  options:
\describe{
  \item{\code{"athaliana"}}{\emph{Arabidopsis thaliana}}
  \item{\code{"hsapiens"}}{\emph{Homo sapiens}}
  \item{\code{"mmusculus"}}{\emph{Mus musculus}}
  \item{\code{"scerevisiae"}}{\emph{Saccharomyces cerevisiae}}
  \item{\code{"celegans"}}{\emph{Caenorhabditis elegans}}
  \item{\code{"tbrucei"}}{\emph{Trypanosoma brucei}}
}
  A custom character vector of transcript IDs may also be provided.
  Must be consistent with the content of \code{transcript_column}.}
}
\value{
A tibble based on \code{residue_data} with the following
  additional columns:
\describe{
  \item{mode_pos}{Integer. Most frequent non-A position reported for
    the transcript.}
  \item{mode_len}{Integer. Most frequent tail length reported for the
    transcript.}
  \item{seg_err_quart}{Numeric. 0.05 quantile of tail length for the
    transcript.}
  \item{qc_pos}{Character. Quality flag: \code{"Y"} for likely
    genuine, \code{"N"} for ambiguous.}
  \item{pos_err_quart}{Numeric. 0.05 quantile of non-A position for
    the transcript and prediction type.}
  \item{count_nonA}{Integer. Number of non-A-containing reads for
    the transcript.}
  \item{count}{Integer. Total number of reads for the transcript.}
}
}
\description{
Annotates each non-A residue position with a quality flag
(\code{qc_pos}) indicating whether the position is likely genuine
(\code{"Y"}) or a potential nanopolish segmentation artefact
(\code{"N"}). The assessment is based on quantile thresholds of
poly(A) tail length, modal non-A position per transcript, and
optional species-specific whitelists of transcripts with A-rich
3' UTRs.
}
\details{
Nanopolish segmentation can misidentify nucleotides from A-rich
3' UTR regions as part of the poly(A) tail. For such transcripts, a
peak of non-A positions accumulates near the transcript body. This
function flags those positions as ambiguous using a combination of:
\itemize{
  \item The modal position of non-A residues per transcript.
  \item The 0.05 quantile of poly(A) tail lengths per transcript
    (segmentation error boundary).
  \item The 0.05 quantile of non-A positions per transcript and
    prediction type.
  \item Species-specific whitelists of transcripts with hybrid tails
    (3' UTRs with > 80\% A in the last 20 positions).
}
}
\examples{
\dontrun{

residue_data_edited <- ninetails::correct_residue_data(
  class_data = results[[1]],
  residue_data = results[[2]],
  transcript_column = "contig")

}

}
\seealso{
\code{\link{correct_class_data}} for the companion function
  that reclassifies reads based on this output,
  \code{\link{reclassify_ninetails_data}} for the high-level wrapper,
  \code{\link{check_tails_guppy}} and \code{\link{create_outputs}} for
  the pipeline that produces the input data.
}
