% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/ninetails_data_postprocessing_functions.R
\name{reclassify_ninetails_data}
\alias{reclassify_ninetails_data}
\title{Reclassifies ambiguous non-A residues to mitigate potential errors
inherited from nanopolish segmentation.}
\usage{
reclassify_ninetails_data(
  residue_data,
  class_data,
  grouping_factor = NULL,
  transcript_column,
  ref = NULL
)
}
\arguments{
\item{residue_data}{Data frame or tibble containing non-A residue
predictions from the ninetails pipeline.}

\item{class_data}{Data frame or tibble containing read_classes
predictions from the ninetails pipeline.}

\item{grouping_factor}{Character string or \code{NULL} (default). A
grouping variable (e.g. \code{"sample_name"}).}

\item{transcript_column}{Character string. Name of the column
containing transcript identifiers (e.g. \code{"contig"},
\code{"ensembl_transcript_id_short"}).}

\item{ref}{Character string, character vector, or \code{NULL}
  (default). Whitelist of transcripts with hybrid tails. Built-in
  options:
\describe{
  \item{\code{"athaliana"}}{\emph{Arabidopsis thaliana}}
  \item{\code{"hsapiens"}}{\emph{Homo sapiens}}
  \item{\code{"mmusculus"}}{\emph{Mus musculus}}
  \item{\code{"scerevisiae"}}{\emph{Saccharomyces cerevisiae}}
  \item{\code{"celegans"}}{\emph{Caenorhabditis elegans}}
  \item{\code{"tbrucei"}}{\emph{Trypanosoma brucei}}
}
  A custom character vector may also be provided. Must be consistent
  with the content of \code{transcript_column}. Using a whitelist is
  optional but allows retrieval of more true positive data.}
}
\value{
A named list with two data frames:
\describe{
  \item{class_data}{Data frame. Corrected read classifications with
    \code{class} and \code{comments} columns updated. Compatible with
    plotting functions.}
  \item{residue_data}{Data frame. Filtered non-A residue predictions
    with ambiguous positions removed. Intermediate QC columns are
    dropped.}
}
}
\description{
High-level wrapper that combines
\code{\link{correct_residue_data}} and
\code{\link{correct_class_data}} into a single call, producing
cleaned class and residue data frames ready for downstream analysis
and visualisation.
}
\details{
Nanopolish segmentation can misidentify nucleotides from A-rich
3' UTR regions as part of the poly(A) tail. When tail boundaries are
recognised incorrectly, non-A positions accumulate near the 3' end of
the transcript, significantly affecting analysis results. This function
flags and removes those ambiguous positions and reclassifies affected
reads accordingly.

The procedure:
\enumerate{
  \item \code{\link{correct_residue_data}} annotates each non-A
    position with a quality flag (\code{qc_pos}).
  \item \code{\link{correct_class_data}} reclassifies reads whose
    \emph{all} non-A positions are flagged as ambiguous.
  \item Ambiguous positions (\code{qc_pos == "N"}) are dropped from
    the residue table.
  \item Corrected columns (\code{corr_class}, \code{corr_comments})
    are renamed to \code{class} and \code{comments}.
}
}
\section{Caution}{

Reads containing only ambiguous non-A positions are reclassified as
\code{"blank"} in the \code{class} column, and their \code{comments}
are changed from \code{"YAY"} to \code{"MPU"}.
}

\examples{
\dontrun{

rec_results <- ninetails::reclassify_ninetails_data(
  residue_data = results[[2]],
  class_data = results[[1]],
  transcript_column = "contig")

}

}
\seealso{
\code{\link{correct_residue_data}} and
  \code{\link{correct_class_data}} for the underlying steps,
  \code{\link{check_tails_guppy}} and \code{\link{create_outputs}} for
  the pipeline that produces the input data.
}
