% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/ninetails_check_tails_guppy.R
\name{check_tails_guppy}
\alias{check_tails_guppy}
\title{Wrapper function for complete DRS processing by ninetails package
(legacy mode).}
\usage{
check_tails_guppy(
  polya_data,
  sequencing_summary,
  workspace,
  num_cores = 1,
  basecall_group = "Basecall_1D_000",
  pass_only = TRUE,
  qc = TRUE,
  save_dir,
  prefix = "",
  part_size = 1000000
)
}
\arguments{
\item{polya_data}{Character string or data frame. Full path of the
\code{.tsv} file produced by nanopolish polya or tailfindr (DRS
only), or an in-memory data frame. Tailfindr input is converted
automatically.}

\item{sequencing_summary}{Character string or data frame. Full path
of the \code{.txt} sequencing summary file, or an in-memory data
frame.}

\item{workspace}{Character string. Full path of the directory
containing basecalled multi-Fast5 files.}

\item{num_cores}{Numeric \code{[1]}. Number of physical cores to use.
Do not exceed 1 less than the number of cores at your disposal.}

\item{basecall_group}{Character string \code{["Basecall_1D_000"]}.
Name of the level in the Fast5 file hierarchy from which data
should be extracted.}

\item{pass_only}{Logical \code{[TRUE]}. If \code{TRUE}, only reads
tagged by nanopolish as \code{"PASS"} are included. If
\code{FALSE}, reads tagged \code{"PASS"} or \code{"SUFFCLIP"} are
included.}

\item{qc}{Logical \code{[TRUE]}. If \code{TRUE}, terminal non-A
residue positions likely arising from nanopolish segmentation
errors are labelled with a \code{"-WARN"} suffix. It is up to the
user whether to include or discard such reads.}

\item{save_dir}{Character string. Full path of the directory where
output files should be stored.}

\item{prefix}{Character string (optional, default \code{""}). If
provided, inserted into output file names between the timestamp and
the file-type suffix.}

\item{part_size}{Numeric \code{[1000000]}. Maximum number of rows
processed at once. Must be >= 1000. If the input exceeds this
value, it is split and processed sequentially.}
}
\value{
A named list with two data frames:
\describe{
  \item{read_classes}{Data frame. Per-read classification including
    columns \code{class} and \code{comments}.}
  \item{nonadenosine_residues}{Data frame. Detailed positional
    information for all detected non-A residues.}
}
A log file and TSV output files (\code{read_classes},
\code{nonadenosine_residues}) are also written to \code{save_dir}.
}
\description{
Orchestrates the full ninetails analysis pipeline for direct RNA
sequencing (DRS) data basecalled with Guppy and characterised by
nanopolish (or tailfindr). The function validates inputs, extracts
poly(A) tail features from multi-Fast5 files, segments tails into
chunks, computes Gramian Angular Fields (GAFs), classifies reads
with a pretrained CNN, and writes output files.
}
\details{
\strong{Legacy mode.} Due to Oxford Nanopore Technologies' transition
from Guppy to Dorado, from Fast5 to POD5, and from R9 to R10
chemistry, this pipeline is maintained for backward compatibility
only and will not be further optimised. For current data, use
\code{\link{check_tails_dorado_DRS}} instead.

The function accepts either nanopolish or tailfindr output (DRS only).
Tailfindr input is automatically converted to nanopolish-like format
via \code{\link{check_polya_length_filetype}}.

For large input files (exceeding \code{part_size} rows), the poly(A)
table is split into parts and processed sequentially via
\code{\link{process_polya_parts}} to avoid memory overflow.

The pipeline steps are:
\enumerate{
  \item Input validation and Fast5 format checking.
  \item Feature extraction
    (\code{\link{create_tail_feature_list}}).
  \item Tail segmentation
    (\code{\link{create_tail_chunk_list}}).
  \item GAF computation (\code{\link{create_gaf_list}}).
  \item CNN classification
    (\code{\link{predict_gaf_classes}}).
  \item Output creation (\code{\link{create_outputs}}).
}

The \code{comments} column in the output encodes detailed read
classification:
\describe{
  \item{IRL}{Insufficient read length.}
  \item{QCF}{Nanopolish QC failed.}
  \item{MAU}{Move transition absent, non-A residue undetected.}
  \item{MPU}{Move transition present, non-A residue undetected.}
  \item{NIN}{Not included in analysis (\code{pass_only = TRUE}).}
  \item{YAY}{Move transition present, non-A residue detected.}
}

Filtering criteria: basecaller move value = 1,
\code{qc_tag \%in\% c("PASS")} (or \code{c("PASS", "SUFFCLIP")}),
and nanopolish-estimated tail length >= 10 nt.
}
\examples{
\dontrun{

results <- ninetails::check_tails_guppy(
  polya_data = system.file('extdata', 'test_data',
                           'nanopolish_output.tsv',
                           package = 'ninetails'),
  sequencing_summary = system.file('extdata', 'test_data',
                                   'sequencing_summary.txt',
                                   package = 'ninetails'),
  workspace = system.file('extdata', 'test_data',
                          'basecalled_fast5',
                          package = 'ninetails'),
  num_cores = 2,
  basecall_group = 'Basecall_1D_000',
  pass_only = TRUE,
  qc = TRUE,
  save_dir = '~/Downloads',
  prefix = "prefix",
  part_size = 2000)

}
}
\seealso{
\code{\link{check_tails_dorado_DRS}} for the current
  (Dorado-based) pipeline,
  \code{\link{process_polya_complete}} and
  \code{\link{process_polya_parts}} for the internal processing
  functions,
  \code{\link{check_polya_length_filetype}} for input format
  detection,
  \code{\link{create_outputs}} for the output assembly step.
}
